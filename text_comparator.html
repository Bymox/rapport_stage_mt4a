<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Comparateur de textes ‚Äî MT4A</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#071029;
  --card:#0f1724;
  --muted:#9aa8bd;
  --accent:#60a5fa;
  --accent-2:#5ff1d9;
  --danger:#ff6b6b;
  --good:#7ad3b7;
  --glass:rgba(255,255,255,0.03);
  --border:rgba(255,255,255,0.04);
  --line-bg: rgba(255,255,255,0.02);
  --diff-bg: rgba(255,92,92,0.06);
  --add-bg: rgba(90,220,150,0.06);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#e6eef8;background:linear-gradient(180deg,var(--bg),#081026);-webkit-font-smoothing:antialiased}
.site{max-width:1200px;margin:28px auto;padding:20px}
.header{display:flex;flex-direction:column;align-items:center;text-align:center;margin-bottom:14px;gap:6px}
.header h1{margin:0;font-size:1.25rem;color:var(--accent)}
.header p{margin:0;color:var(--muted);max-width:880px;line-height:1.45}
.divider{height:6px;width:120px;margin:12px auto;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:10px}

/* Top parameter bar (full width) */
.topbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap}
.topbar .group{display:flex;gap:8px;align-items:center}
.topbar .param-card{background:var(--card);border:1px solid var(--border);padding:8px;border-radius:10px;display:flex;gap:8px;align-items:center}

/* styled buttons and inputs */
.file-btn{
  position:relative; overflow:hidden; display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,var(--accent),#3b82f6);
  color:#071026;font-weight:700;border:0;cursor:pointer; font-size:0.95rem;
  transition:transform .12s ease, box-shadow .12s ease;
}
.file-btn.secondary{ background:transparent;color:var(--muted); border:1px solid var(--border); font-weight:600; }
.file-input{position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer}
.icon{font-size:16px}

/* action buttons */
.action-btn{padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,var(--accent-2),#4fe0c7);color:#042028;font-weight:700;border:0;cursor:pointer}
.ghost{background:transparent;border:1px solid var(--border);color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}

/* main layout: two columns below topbar */
.main{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}
@media (max-width:1050px){ .main{grid-template-columns:1fr} }

/* left: two editors stacked */
.left-col{display:flex;flex-direction:column;gap:12px}
.editor-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
.editor-title{display:flex;justify-content:space-between;align-items:center}
.editor-title h3{margin:0;font-size:0.95rem}
.textarea{width:100%;min-height:220px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:#06101a;color:var(--text);font-family:ui-monospace, SFMono-Regular, Menlo, "Roboto Mono", monospace;font-size:0.95rem;resize:vertical}

/* right: results (top) and comparison (bottom) */
.right-col{display:flex;flex-direction:column;gap:12px}
.results-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px}
.results-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.badge{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--muted);font-weight:700}
.badge.strong{background:linear-gradient(180deg,var(--accent-2),#7ad3b7);color:#042028}
.diff-list{display:flex;gap:6px;flex-wrap:wrap;max-height:120px;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.03);border:1px solid rgba(255,255,255,0.02)}
.diff-list button{padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer;font-size:0.85rem}
.diff-list button:hover{background:rgba(255,255,255,0.02);color:var(--accent)}

/* comparison viewer */
.compare-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.03);overflow:hidden}
.compare-views{display:flex;gap:10px;height:420px}
@media (max-width:920px){ .compare-views{flex-direction:column;height:auto} }

.col{flex:1;overflow:auto;border-radius:8px;padding:8px;background:var(--card);border:1px solid rgba(255,255,255,0.02)}
.line{display:flex;gap:8px;padding:8px;border-radius:6px;margin-bottom:6px;background:var(--line-bg);align-items:flex-start}
.ln{width:56px;flex:0 0 56px;color:var(--muted);font-size:0.85rem;text-align:right;padding-right:12px;border-right:1px solid rgba(255,255,255,0.02)}
.lc{flex:1;white-space:pre-wrap;font-family:ui-monospace, SFMono-Regular, Menlo, "Roboto Mono", monospace;font-size:0.92rem;word-break:break-word}
.line.diff{background:var(--diff-bg);border:1px solid rgba(255,92,92,0.14)}
.line.add{background:var(--add-bg);border:1px solid rgba(90,220,150,0.12)}
.line.missing .lc{color:var(--muted);font-style:italic}

/* small helper */
.small{font-size:0.9rem;color:var(--muted)}
.footer{margin-top:20px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <div class="site">
    <div class="header">
      <h1>Comparateur de textes ‚Äî MT4A</h1>
      <p>Topbar pour les param√®tres ; dessous la zone divis√©e : gauche = textes, droite = r√©sultats + comparaison.</p>
      <div class="divider" aria-hidden="true"></div>
    </div>

    <!-- TOPBAR: full width controls (left ‚Üí right) -->
    <div class="topbar" role="toolbar" aria-label="Barre de param√®tres">
      <div class="group param-card" aria-hidden="false">
        <label class="file-btn" title="Charger Fichier 1">
          üìÅ Choisir Fichier 1
          <input id="file1_top" class="file-input" type="file" accept=".txt" />
        </label>
        <label class="file-btn secondary" title="Charger Fichier 2">
          üìÇ Choisir Fichier 2
          <input id="file2_top" class="file-input" type="file" accept=".txt" />
        </label>
        <button id="autoToggleTop" class="ghost" title="Activer / d√©sactiver l'auto-compare">Auto: ON</button>
      </div>

      <div class="group param-card">
        <button id="compareBtnTop" class="action-btn" title="Comparer maintenant">Comparer</button>
        <button id="copyBtnTop" class="file-btn" title="Copier le r√©sum√©">Copier diff</button>
        <button id="downloadBtnTop" class="file-btn secondary" title="T√©l√©charger le r√©sum√©">T√©l√©charger diff</button>
        <button id="resetBtnTop" class="ghost" title="R√©initialiser">R√©initialiser</button>
      </div>
    </div>

    <!-- MAIN CONTENT: left editors / right results + comparison -->
    <div class="main">
      <!-- LEFT: stacked editors -->
      <div class="left-col">
        <div class="editor-card">
          <div class="editor-title">
            <h3>Fichier 1</h3>
            <label class="file-btn secondary" title="Charger Fichier 1">
              Choisir fichier
              <input id="file1" class="file-input" type="file" accept=".txt" />
            </label>
          </div>
          <textarea id="ta1" class="textarea" placeholder="Colle ou tape le contenu de Fichier1.txt ici..." spellcheck="false"></textarea>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Lignes: <span id="len1">0</span></div>
            <div class="small">‚Äî</div>
          </div>
        </div>

        <div class="editor-card">
          <div class="editor-title">
            <h3>Fichier 2</h3>
            <label class="file-btn secondary" title="Charger Fichier 2">
              Choisir fichier
              <input id="file2" class="file-input" type="file" accept=".txt" />
            </label>
          </div>
          <textarea id="ta2" class="textarea" placeholder="Colle ou tape le contenu de Fichier2.txt ici..." spellcheck="false"></textarea>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="small">Lignes: <span id="len2">0</span></div>
            <div class="small">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- RIGHT: results (top) + comparison (bottom) -->
      <div class="right-col">
        <div class="results-card" role="region" aria-label="R√©sultats">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div style="display:flex;gap:10px;align-items:center">
              <div class="badge" id="totalLines">Lignes : 0 / 0</div>
              <div class="badge strong" id="diffCount">Diff√©rences : 0</div>
            </div>
            <div class="small">Clique sur une diff√©rence dans la liste pour y aller</div>
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div class="small">Diff√©rences (ligne) :</div>
            <div class="diff-list" id="diffList" aria-live="polite">‚Äî</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center;margin-top:6px;flex-wrap:wrap">
            <div class="small">Actions :</div>
            <button id="copyDiff" class="file-btn">Copier le r√©sum√©</button>
            <button id="downloadDiff" class="file-btn secondary">T√©l√©charger .txt</button>
          </div>
        </div>

        <div class="compare-card" role="region" aria-label="Comparaison">
          <div class="small" style="margin-bottom:8px">Vue c√¥te-√†-c√¥te (les lignes diff√©rentes sont surlign√©es)</div>
          <div class="compare-views" id="compareViews">
            <div class="col" id="col1" aria-label="Vue Fichier 1"></div>
            <div class="col" id="col2" aria-label="Vue Fichier 2"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">Fran√ßois Bordas ‚Äî Comparateur de lignes ‚Äî MT4A</div>
  </div>

<script>
/* ---------- DOM refs ---------- */
const ta1 = document.getElementById('ta1');
const ta2 = document.getElementById('ta2');
const file1 = document.getElementById('file1');
const file2 = document.getElementById('file2');
const file1_top = document.getElementById('file1_top');
const file2_top = document.getElementById('file2_top');

const len1El = document.getElementById('len1');
const len2El = document.getElementById('len2');
const totalLines = document.getElementById('totalLines');
const diffCount = document.getElementById('diffCount');
const diffList = document.getElementById('diffList');
const col1 = document.getElementById('col1');
const col2 = document.getElementById('col2');

const autoToggleTop = document.getElementById('autoToggleTop');
const compareBtnTop = document.getElementById('compareBtnTop');
const copyBtnTop = document.getElementById('copyBtnTop');
const downloadBtnTop = document.getElementById('downloadBtnTop');
const resetBtnTop = document.getElementById('resetBtnTop');

const copyDiff = document.getElementById('copyDiff');
const downloadDiff = document.getElementById('downloadDiff');

/* ---------- state ---------- */
let autoCompare = true;
let ignoreScroll = false;

/* ---------- helpers ---------- */
function readFileInput(input, targetTextarea){
  const f = input.files && input.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = e => {
    targetTextarea.value = String(e.target.result).replace(/\r\n/g, '\n');
    updateLineCounts();
    if (autoCompare) debounceCompare();
  };
  reader.readAsText(f, 'utf-8');
}
[file1, file1_top].forEach(el => el.addEventListener('change', ()=> readFileInput(el, ta1)));
[file2, file2_top].forEach(el => el.addEventListener('change', ()=> readFileInput(el, ta2)));

function splitLines(text){
  return String(text === undefined || text === null ? '' : text).replace(/\r\n/g,'\n').split('\n');
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ---------- render / compare ---------- */
function updateLineCounts(){
  const l1 = splitLines(ta1.value).length;
  const l2 = splitLines(ta2.value).length;
  len1El.textContent = l1;
  len2El.textContent = l2;
}

function renderComparison(){
  const lines1 = splitLines(ta1.value);
  const lines2 = splitLines(ta2.value);
  const maxLen = Math.max(lines1.length, lines2.length);
  col1.innerHTML = '';
  col2.innerHTML = '';
  const diffs = [];

  for (let i=0;i<maxLen;i++){
    const l1 = (i < lines1.length) ? lines1[i] : '<-- ligne absente -->';
    const l2 = (i < lines2.length) ? lines2[i] : '<-- ligne absente -->';
    const isDiff = l1 !== l2;

    if (isDiff) diffs.push(i+1);

    // left
    const d1 = document.createElement('div');
    d1.className = 'line ' + (isDiff ? (i >= lines2.length ? 'add' : 'diff') : 'same') + (i >= lines1.length ? ' missing' : '');
    d1.dataset.line = i+1;
    d1.innerHTML = `<div class="ln">${i+1}</div><div class="lc">${escapeHtml(l1)}</div>`;
    col1.appendChild(d1);

    // right
    const d2 = document.createElement('div');
    d2.className = 'line ' + (isDiff ? (i >= lines1.length ? 'add' : 'diff') : 'same') + (i >= lines2.length ? ' missing' : '');
    d2.dataset.line = i+1;
    d2.innerHTML = `<div class="ln">${i+1}</div><div class="lc">${escapeHtml(l2)}</div>`;
    col2.appendChild(d2);
  }

  totalLines.textContent = `Lignes : ${lines1.length} / ${lines2.length}`;
  diffCount.textContent = `Diff√©rences : ${diffs.length}`;
  renderDiffList(diffs);
  return diffs;
}

function renderDiffList(diffs){
  diffList.innerHTML = '';
  if (!diffs.length){
    diffList.textContent = 'Aucune diff√©rence';
    return;
  }
  diffs.forEach(n => {
    const b = document.createElement('button');
    b.textContent = `L ${n}`;
    b.addEventListener('click', ()=> scrollToLine(n));
    diffList.appendChild(b);
  });
}

/* ---------- scroll sync & navigate ---------- */
function syncScroll(source, target){
  if (ignoreScroll) return;
  ignoreScroll = true;
  target.scrollTop = source.scrollTop;
  setTimeout(()=> ignoreScroll = false, 40);
}
col1.addEventListener('scroll', ()=> syncScroll(col1, col2));
col2.addEventListener('scroll', ()=> syncScroll(col2, col1));

function scrollToLine(n){
  const el1 = col1.querySelector('.line[data-line="'+n+'"]');
  const el2 = col2.querySelector('.line[data-line="'+n+'"]');
  if (el1){
    const offset = el1.offsetTop - col1.clientHeight/2 + el1.clientHeight/2;
    col1.scrollTop = Math.max(0, offset);
  }
  if (el2){
    const offset = el2.offsetTop - col2.clientHeight/2 + el2.clientHeight/2;
    col2.scrollTop = Math.max(0, offset);
  }
  // highlight flash
  [el1, el2].forEach(el => {
    if (!el) return;
    el.style.transition = 'box-shadow .25s ease';
    el.style.boxShadow = '0 0 0 4px rgba(255,255,255,0.06)';
    setTimeout(()=> el.style.boxShadow = '', 350);
  });
}

/* ---------- compare triggers ---------- */
let debounceTimer = null;
function debounceCompare(){ if (debounceTimer) clearTimeout(debounceTimer); debounceTimer = setTimeout(()=> { compareNow(); debounceTimer = null; }, 200); }

function compareNow(){
  updateLineCounts();
  const diffs = renderComparison();
  return diffs;
}

/* ---------- UI events ---------- */
ta1.addEventListener('input', ()=> { updateLineCounts(); if (autoCompare) debounceCompare(); });
ta2.addEventListener('input', ()=> { updateLineCounts(); if (autoCompare) debounceCompare(); });

compareBtnTop.addEventListener('click', ()=> compareNow());
resetBtnTop.addEventListener('click', ()=> {
  ta1.value = ''; ta2.value = '';
  col1.innerHTML = ''; col2.innerHTML = ''; diffList.innerHTML = '';
  len1El.textContent = '0'; len2El.textContent = '0';
  totalLines.textContent = 'Lignes : 0 / 0'; diffCount.textContent = 'Diff√©rences : 0';
});

autoToggleTop.addEventListener('click', ()=> {
  autoCompare = !autoCompare;
  autoToggleTop.textContent = `Auto: ${autoCompare ? 'ON' : 'OFF'}`;
  autoToggleTop.classList.toggle('ghost', !autoCompare);
});

/* file inputs (top and per-editor are wired to same handlers above) */
[file1, file1_top].forEach(el => el.addEventListener('change', ()=> readFileInput(el, ta1)));
[file2, file2_top].forEach(el => el.addEventListener('change', ()=> readFileInput(el, ta2)));

/* copy & download summary */
function buildDiffSummary(){
  const lines1 = splitLines(ta1.value);
  const lines2 = splitLines(ta2.value);
  const maxLen = Math.max(lines1.length, lines2.length);
  let out = '';
  let differences = 0;
  for (let i=0;i<maxLen;i++){
    const l1 = (i<lines1.length) ? lines1[i] : '<-- ligne absente -->';
    const l2 = (i<lines2.length) ? lines2[i] : '<-- ligne absente -->';
    if (l1 !== l2){
      differences++;
      out += `\nLigne ${i+1} :\n  Fichier1.txt | ${l1}\n  Fichier2.txt | ${l2}\n`;
    }
  }
  if (differences === 0) out = '‚úÖ Aucun √©cart : les deux textes sont identiques.\n';
  out += `\nNombre total de lignes diff√©rentes : ${differences}\n`;
  return out;
}

copyBtnTop.addEventListener('click', ()=> {
  const txt = buildDiffSummary();
  navigator.clipboard?.writeText(txt).then(()=> alert('Diff copi√© dans le presse-papier.'), ()=> alert('Impossible de copier.'));
});
copyDiff.addEventListener('click', ()=> copyBtnTop.click());

downloadBtnTop.addEventListener('click', ()=> {
  const content = buildDiffSummary();
  const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'diff_results.txt'; document.body.appendChild(a); a.click();
  setTimeout(()=> { URL.revokeObjectURL(url); a.remove(); }, 500);
});
downloadDiff.addEventListener('click', ()=> downloadBtnTop.click());

/* ---------- init demo content ---------- */
ta1.value = `Ligne identique
Une ligne diff√©rente A
Ligne commune 3
Ligne commune 4
Fin A`;
ta2.value = `Ligne identique
Une ligne diff√©rente B
Ligne commune 3
Ligne commune 4
Fin B
Ligne suppl√©mentaire 6`;
updateLineCounts();
compareNow();
</script>
</body>
</html>
